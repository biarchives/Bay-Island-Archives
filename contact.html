<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bay Islands Archives</title>
  <link rel="stylesheet" href="css/contact.css" />
</head>

<body>
  <div id="header-placeholder"></div>
  <main class="site-main">
    <div class="contact-wrapper">
      <section class="intro-text">
        <h2>Get in Touch</h2>
        <p>
          Please feel free to reach out to us â€” we're always open to hearing from you. If you have historical materials,
          photographs, or records related to the Bay Islands, we're always accepting new submissions.
        </p>
      </section>

      <div class="form-panel">
        <div class="tab-buttons">
          <button class="tab-button active" data-tab="contact">Contact Us</button>
          <button class="tab-button" data-tab="submit">Submit a Record</button>
        </div>

        <div id="contact" class="tab-panel active">
          <form id="contact-form" action="https://formspree.io/f/xqalnljv" method="post">
            <label for="name">Name</label>
            <input type="text" id="name" name="name">

            <label for="email">Email</label>
            <input type="email" id="email" name="_replyto">

            <label for="message">Message</label>
            <textarea id="message" name="message"></textarea>

            <button type="submit">Send</button>
          </form>
        </div>

        <div id="submit" class="tab-panel">
          <form id="submit-form" action="https://formspree.io/f/mdkdbdjj" method="post">
            <label for="submit-name">Name</label>
            <input type="text" id="submit-name" name="submit-name" required="">

            <label for="submit-email">Email</label>
            <input type="email" id="submit-email" name="_replyto" required="">

            <label for="file-link">Link to File(s)</label>
            <input type="url" id="file-link" name="file-link">
            <small class="form-help-text">
              Please use a third-party service like Google Drive, Dropbox, or Imgur to share files.
            </small>

            <label for="record-name">Record Name</label>
            <input type="text" id="record-name" name="record-name">

            <label for="date">Date</label>
            <input type="date" id="date" name="date">

            <label for="location">Location</label>
            <input type="text" id="location" name="location">

            <label for="description">Description</label>
            <textarea id="description" name="description"></textarea>

            <button type="submit">Submit</button>
          </form>
        </div>
        <div class="confirmation-message" id="confirmation-contact" style="display: none;">
          <h2>Thank You!</h2>
          <p>Your message has been sent successfully. We will get back to you shortly.</p>
        </div>
        <div class="confirmation-message" id="confirmation-submit" style="display: none;">
          <h2>Submission Received!</h2>
          <p>Thank you for your valuable contribution. We will review your record and get in touch.</p>
        </div>
      </div>
    </div>
  </main>

  <div id="footer-placeholder"></div>

  <script>
    // Load the header
    fetch('base/header.html')
      .then(response => response.text())
      .then(data => {
        document.getElementById('header-placeholder').innerHTML = data;

        // This is where you add the code to set the active link
        const currentPage = window.location.pathname.split('/').pop().replace('.html', '');
        const activeLink = document.querySelector(`[data-page="${currentPage}"]`);

        if (activeLink) {
          activeLink.classList.add('active');
        }
      });

    // Load the footer
    fetch('base/footer.html')
      .then(response => response.text())
      .then(data => {
        document.getElementById('footer-placeholder').innerHTML = data;
      });

    // --- Form Submission State ---
    let contactSubmitted = false;
    let submitSubmitted = false;

    // Add tab logic for .tab-button and .tab-panel
    const tabButtons = document.querySelectorAll('.tab-button');
    const tabPanels = document.querySelectorAll('.tab-panel');

    const confirmationContact = document.getElementById('confirmation-contact');
    const confirmationSubmit = document.getElementById('confirmation-submit');

    tabButtons.forEach(button => {
      button.addEventListener('click', () => {
        const tabId = button.dataset.tab;

        // First, hide all panels and confirmation messages
        tabPanels.forEach(p => p.classList.remove('active'));
        confirmationContact.style.display = 'none';
        confirmationSubmit.style.display = 'none';

        // Now, show the correct content based on the active tab and submission state
        if (tabId === 'contact' && contactSubmitted) {
          // If the contact form was submitted, show its confirmation message
          document.getElementById('contact').classList.add('active');
          confirmationContact.style.display = 'block';
        } else if (tabId === 'submit' && submitSubmitted) {
          // If the submit form was submitted, show its confirmation message
          document.getElementById('submit').classList.add('active');
          confirmationSubmit.style.display = 'block';
        } else {
          // Otherwise, show the form panel for the selected tab
          document.getElementById(tabId).classList.add('active');
        }

        // Update active tab button class
        tabButtons.forEach(b => b.classList.remove('active'));
        button.classList.add('active');
      });
    });

    // --- Form Submission Logic ---
    const contactPanel = document.getElementById('contact');
    const submitPanel = document.getElementById('submit');
    const contactForm = document.getElementById('contact-form');
    const submitForm = document.getElementById('submit-form');

    async function handleFormSubmission(event, form, panel, confirmationMessage) {
      event.preventDefault(); // Stop the default page reload

      const formData = new FormData(form);

      try {
        const response = await fetch(form.action, {
          method: form.method,
          body: formData,
          headers: {
            'Accept': 'application/json'
          }
        });

        if (response.ok) {
          // Check which form was submitted and set the state flag
          if (form.id === 'contact-form') {
            contactSubmitted = true;
          } else if (form.id === 'submit-form') {
            submitSubmitted = true;
          }

          // Hide the form panel and show the confirmation message
          panel.style.display = 'none';
          confirmationMessage.style.display = 'block';
        } else {
          const errorData = await response.json();
          alert(`Oops! There was an error: ${errorData.error || 'Server error'}. Please check your form and try again.`);
        }
      } catch (error) {
        alert('An error occurred. Please check your network connection and try again.');
      }
    }

    // Event listeners for each form
    contactForm.addEventListener('submit', (event) => {
      handleFormSubmission(event, contactForm, contactPanel, confirmationContact);
    });

    submitForm.addEventListener('submit', (event) => {
      handleFormSubmission(event, submitForm, submitPanel, confirmationSubmit);
    });
  </script>
</body>

</html>
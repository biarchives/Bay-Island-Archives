<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bay Islands Archives</title>
  <link rel="stylesheet" href="css/contact.css" />

  <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
  <link rel="manifest" href="icons/site.webmanifest">
</head>

<body>
  <div id="header-placeholder"></div>
  <main class="site-main">
    <div class="contact-wrapper">
      <section class="intro-text">
        <h1>Get in Touch</h1>
        <p>
          Please feel free to reach out to us â€” we're always open to hearing from you. If you have historical materials,
          photographs, or records related to the Bay Islands, we're always accepting new submissions.
        </p>
      </section>

      <div class="form-panel">
        <div class="tab-buttons">
          <button class="tab-button active" data-tab="contact">Contact Us</button>
          <button class="tab-button" data-tab="submit">Submit a Record</button>
        </div>

        <div id="contact" class="tab-panel active">
          <form id="contact-form" action="https://formspree.io/f/xqalnljv" method="post">
            <label for="name">Name</label>
            <input type="text" id="name" name="name">

            <label for="email">Email</label>
            <input type="email" id="email" name="_replyto">

            <label for="message">Message</label>
            <textarea id="message" name="message"></textarea>

            <button type="submit">Send</button>
          </form>
        </div>

        <div id="submit" class="tab-panel">
          <p class="google-form-intro">
            To submit historical records, please use our secure form. This allows you to upload files directly
            and provide detailed information.
          </p>
          <script
            type="text/javascript">function zforms_open_window(url, height, width) { var leftPos = 0; var topPos = 0; if (screen) { leftPos = (screen.width - width) / 2; topPos = (screen.height - height) / 2; window.open(url, null, 'width=' + width + ',height=' + height + ',left=' + leftPos + ',top=' + topPos + ', toolbar=0, location=0, status=1, scrollbars=1, resizable=1'); } }</script>
          <a href='https://forms.zohopublic.com/adminbiarc1/form/Submitarecord/formperma/ecFqz3TEMz0uh19N5eH6iniJgE_o9caL8ZM-ve_bXBA'
            title="Submit a record" target='_blank'
            onclick="zforms_open_window(this.href, 648, 700); return false">Access Form</a>

        </div>
        <div class="confirmation-message" id="confirmation-contact" style="display: none;">
          <h2>Thank You!</h2>
          <p>Your message has been sent successfully. We will get back to you shortly.</p>
        </div>
        <div class="confirmation-message" id="confirmation-submit" style="display: none;">
          <h2>Submission Received!</h2>
          <p>Thank you for your valuable contribution. We will review your record and get in touch.</p>
        </div>
      </div>
    </div>
  </main>

  <div id="footer-placeholder"></div>

  <script>
    // Load the header
    fetch('base/header.html')
      .then(response => response.text())
      .then(data => {
        document.getElementById('header-placeholder').innerHTML = data;

        // This is where you add the code to set the active link
        const currentPage = window.location.pathname.split('/').pop().replace('.html', '');
        const activeLink = document.querySelector(`[data-page="${currentPage}"]`);

        if (activeLink) {
          activeLink.classList.add('active');
        }
      });

    // Load the footer
    fetch('base/footer.html')
      .then(response => response.text())
      .then(data => {
        document.getElementById('footer-placeholder').innerHTML = data;
      });

    // Add tab logic for .tab-button and .tab-panel
    const tabButtons = document.querySelectorAll('.tab-button');
    const tabPanels = document.querySelectorAll('.tab-panel');

    const confirmationContact = document.getElementById('confirmation-contact');
    const confirmationSubmit = document.getElementById('confirmation-submit');
    const contactForm = document.getElementById('contact-form');

    tabButtons.forEach(button => {
      button.addEventListener('click', () => {
        // Hide all confirmation messages when a new tab is selected
        confirmationContact.style.display = 'none';
        confirmationSubmit.style.display = 'none';

        tabButtons.forEach(b => b.classList.remove('active'));
        tabPanels.forEach(p => p.classList.remove('active'));

        button.classList.add('active');
        document.getElementById(button.dataset.tab).classList.add('active');
      });
    });

    // --- Form Submission Logic for the Contact Form ---
    const contactPanel = document.getElementById('contact');
    async function handleFormSubmission(event, form, panel, confirmationMessage) {
      event.preventDefault(); // Stop the default page reload

      const formData = new FormData(form);

      try {
        const response = await fetch(form.action, {
          method: form.method,
          body: formData,
          headers: {
            'Accept': 'application/json'
          }
        });

        // Check if the response is OK (2xx status code)
        if (response.ok) {
          panel.style.display = 'none'; // Hide the entire panel
          confirmationMessage.style.display = 'block'; // Show the confirmation message
        } else {
          // Handle HTTP errors (4xx or 5xx status codes)
          const errorData = await response.json();
          alert(`Oops! There was an error: ${errorData.error || 'Server error'}. Please check your form and try again.`);
        }
      } catch (error) {
        // Handle network errors (e.g., no internet connection)
        alert('An error occurred. Please check your network connection and try again.');
      }
    }

    // Event listeners for the contact form
    contactForm.addEventListener('submit', (event) => {
      handleFormSubmission(event, contactForm, contactPanel, confirmationContact);
    });
  </script>
</body>

</html>